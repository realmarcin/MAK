setwd("~/Desktop")

install.packages("amap_0.8-6_pretest.tgz", repos = NULL, type="source")


library(amap)
load("reproduce_clustering_error_data")
Iibatch <- c(47,69,106,136,147,200,225,238,269,339,342,412,426,468,470,502,520,567,581,639,661,816,920,926,1048,1071,1085,1149,1225,1366,1380,1384,1402,1455,1523,1530,1544,1563,1577,1612,1653,1698,1703,1715,1730,1751,1753,1822,1851,1873,1928,1957,1960,1961,1995,2019,2037,2053,2077,2081,2132,2171,2230,2253,2268,2278,2296,2311,2321,2333,2366,2380,2382,2447,2478,2491,2523,2564,2605,2609,2695,2713,2736,2759,2782,2844,2861,2868,2871,2875,3001,3111,3124,3140,3157,3163,3210,3223,3250,3377,3448,3470,3506,3543,3583,3639,3655,3746,3778,3798,3829,3834,3835,3944,3969,4018,4062,4102,4109,4110,4114,4158,4179,4218,4273,4310,4381,4384,4386,4395,4419,4432,4449,4478,4505,4558,4578,4585,4587,4613,4628,4703,4737,4744,4754,4774,4791,4814,4827,4840,4870,4873,4887,4915,4922,4942,4943,5077,5085,5172,5205,5394,5484,5487,5502,5558,5588,5590,5599,5604,5701,5715,5751,5766,5814,5850,5892,5898,5909,5944,6036,6058,6068,6137)
Jjbatch <- c(110,111,160,404,581,617)

#data prep: take abs and impute missing values
xmat=abs(t(expr_data[Iibatch,Jjbatch]))
xmat=t(apply(xmat,2,function(xm1){ xm1[is.na(xm1)]=mean(xm1,na.rm=TRUE); xm1}))
IndB=Iibatch

hc=hcluster(xmat,method="correlation")
hc$height